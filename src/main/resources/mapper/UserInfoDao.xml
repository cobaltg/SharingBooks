<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sharingbooks.dao.UserInfoDao">

	<resultMap type="com.sharingbooks.entity.UserInfo" id="UserInfoResult">
	  <id column="user_id" jdbcType="INTEGER" property="userId"/>
	  <result column="user_name" jdbcType="VARCHAR" property="userName"/>
	  <result column="user_pwd" jdbcType="VARCHAR" property="userPwd"/>
	  <result column="user_phone" jdbcType="VARCHAR" property="userPhone"/>
	</resultMap>

	<insert id="addUser" parameterType="com.sharingbooks.entity.UserInfo">
	  insert into userinfo
	    (user_name,user_pwd,user_phone)
	  values
	    (#{userName},#{userPwd},)#{userPhone}
	</insert>
	
	<update id="updateUser" parameterType="com.sharingbooks.entity.UserInfo">
	  update userinfo set
	    user_name=#{userName},
	    user_pwd=#{userPwd),
	    user_phone=#{userPhone} 
	</update>
	
	<select id="getUser" parameterType="com.sharingbooks.entity.UserInfo" resultType="int">
	  select
	    count(*)
	  from
	    userinfo
	  where 
	    user_pwd=#{userPwd} and (user_name=#{userName} or user_phone=#{userPhone})    
	</select>
	
	
	<select id="queryUserInfoList" parameterType="java.util.Map" resultMap="UserInfoResult">
	  select
	    user_id,user_name,user_pwd,borrower_phone,user_phone
	  from
	    userinfo
	  <where>
	    <if test="borrowedbook.bookName!=null and !&quot;&quot;.equals(borrowedbook.bookName.trim())">and book_name like '%' #{borrowedbook.bookName} '%'</if>
	    <if test="borrowedbook.bookDescription!=null and !&quot;&quot;.equals(borrowedbook.bookDescription.trim())">and book_description like '%' #{borrowedbook.bookDescription} '%'</if>
	  </where>
	  order by user_id limit #{page.dbIndex},#{page.dbNumber}
	</select>
</mapper>
